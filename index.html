<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Privacy Biometric Authentication System</title>
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>üîê</text></svg>" type="image/svg+xml">

    <!-- Ethers v6 and Buffer polyfill for browser compatibility -->
    <script src="https://cdn.jsdelivr.net/npm/buffer@6.0.3/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ethers@6.8.0/dist/ethers.umd.min.js"></script>
    <script>
        // Global definitions for browser compatibility
        window.global = window.global || window;
        window.process = window.process || { env: {} };

        // Fallback detection for ethers library
        if (typeof ethers === 'undefined') {
            console.error('Ethers library failed to load from primary CDN, trying fallback...');
            const fallbackScript = document.createElement('script');
            fallbackScript.src = 'https://unpkg.com/ethers@6.8.0/dist/ethers.umd.min.js';
            fallbackScript.onerror = function() {
                console.error('All ethers CDNs failed to load');
                document.body.innerHTML = '<div style="padding:50px;text-align:center;color:red;font-family:Arial"><h2>‚ö†Ô∏è Error Loading Dependencies</h2><p>Unable to load ethers.js library. Please check your internet connection and try again.</p></div>';
            };
            document.head.appendChild(fallbackScript);
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #0a0a0a;
            background-image:
                radial-gradient(circle at 25% 25%, #1a1a2e 0%, transparent 50%),
                radial-gradient(circle at 75% 75%, #16213e 0%, transparent 50%),
                linear-gradient(135deg, #0f0f23 0%, #0a0a0a 100%);
            min-height: 100vh;
            color: #ffffff;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(120, 198, 255, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px;
            position: relative;
        }

        .header {
            text-align: center;
            margin-bottom: 60px;
            position: relative;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 4px;
            background: linear-gradient(90deg, #7c77c6, #ff77c6, #77c6ff);
            border-radius: 2px;
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { box-shadow: 0 0 10px rgba(124, 119, 198, 0.5); }
            to { box-shadow: 0 0 20px rgba(124, 119, 198, 0.8), 0 0 30px rgba(255, 119, 198, 0.3); }
        }

        .header h1 {
            font-size: clamp(2.5rem, 5vw, 4rem);
            font-weight: 700;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #ffffff 0%, #7c77c6 50%, #ff77c6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1.2;
        }

        .header p {
            font-size: 1.25rem;
            opacity: 0.8;
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.6;
            font-weight: 400;
        }

        .card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            padding: 40px;
            margin-bottom: 30px;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        }

        .card:hover {
            transform: translateY(-8px);
            box-shadow:
                0 32px 64px rgba(0, 0, 0, 0.3),
                0 8px 32px rgba(124, 119, 198, 0.15);
            border-color: rgba(124, 119, 198, 0.3);
        }

        .connect-wallet {
            text-align: center;
            padding: 80px 40px;
        }

        .connect-wallet h2 {
            font-size: 2.5rem;
            font-weight: 600;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #ffffff 0%, #7c77c6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .connect-wallet p {
            font-size: 1.1rem;
            opacity: 0.7;
            margin-bottom: 40px;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        .connect-btn {
            background: linear-gradient(135deg, #7c77c6 0%, #ff77c6 100%);
            color: white;
            border: none;
            padding: 18px 48px;
            font-size: 1.1rem;
            font-weight: 500;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            margin: 10px;
            position: relative;
            overflow: hidden;
            font-family: 'Inter', sans-serif;
        }

        .connect-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.6s;
        }

        .connect-btn:hover::before {
            left: 100%;
        }

        .connect-btn:hover {
            transform: translateY(-2px);
            box-shadow:
                0 20px 40px rgba(124, 119, 198, 0.3),
                0 8px 16px rgba(0, 0, 0, 0.2);
        }

        .connect-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .status {
            margin: 30px 0;
            padding: 20px;
            border-radius: 16px;
            font-weight: 500;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 1rem;
        }

        .status.success {
            background: rgba(34, 197, 94, 0.1);
            color: #10b981;
            border-color: rgba(34, 197, 94, 0.2);
            box-shadow: 0 8px 32px rgba(34, 197, 94, 0.1);
        }

        .status.error {
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
            border-color: rgba(239, 68, 68, 0.2);
            box-shadow: 0 8px 32px rgba(239, 68, 68, 0.1);
        }

        .status.info {
            background: rgba(59, 130, 246, 0.1);
            color: #3b82f6;
            border-color: rgba(59, 130, 246, 0.2);
            box-shadow: 0 8px 32px rgba(59, 130, 246, 0.1);
        }

        .main-interface {
            display: none;
        }

        .main-interface.active {
            display: block;
        }

        .wallet-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            padding: 24px 32px;
            background: rgba(124, 119, 198, 0.1);
            border: 1px solid rgba(124, 119, 198, 0.2);
            border-radius: 20px;
            backdrop-filter: blur(20px);
        }

        .wallet-details h3 {
            margin-bottom: 8px;
            font-size: 1.2rem;
            font-weight: 600;
            color: #ffffff;
        }

        .wallet-details p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.95rem;
            font-family: 'JetBrains Mono', monospace;
        }

        .disconnect-btn {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
            padding: 12px 24px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .disconnect-btn:hover {
            background: rgba(239, 68, 68, 0.3);
            transform: translateY(-2px);
        }

        .function-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .function-card {
            background: rgba(255, 255, 255, 0.02);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 32px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            position: relative;
            overflow: hidden;
        }

        .function-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(124, 119, 198, 0.3), transparent);
        }

        .function-card:hover {
            border-color: rgba(124, 119, 198, 0.3);
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }

        .function-card h3 {
            color: #ffffff;
            margin-bottom: 20px;
            font-size: 1.4rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .input-group {
            margin-bottom: 24px;
        }

        .input-group label {
            display: block;
            margin-bottom: 12px;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.95rem;
        }

        .input-group input {
            width: 100%;
            padding: 16px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            font-size: 1rem;
            color: #ffffff;
            font-family: 'JetBrains Mono', monospace;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .input-group input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        .input-group input:focus {
            outline: none;
            border-color: rgba(124, 119, 198, 0.5);
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 0 0 3px rgba(124, 119, 198, 0.1);
        }

        .action-btn {
            background: linear-gradient(135deg, #7c77c6 0%, #ff77c6 100%);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            width: 100%;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            font-family: 'Inter', sans-serif;
        }

        .action-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.6s;
        }

        .action-btn:hover::before {
            left: 100%;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(124, 119, 198, 0.4);
        }

        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .contract-info {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 20px;
            padding: 32px;
            margin-bottom: 40px;
            backdrop-filter: blur(20px);
        }

        .contract-info h3 {
            color: #3b82f6;
            margin-bottom: 24px;
            font-size: 1.5rem;
            font-weight: 600;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .info-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 24px 20px;
            border-radius: 16px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .info-item:hover {
            transform: translateY(-2px);
            background: rgba(255, 255, 255, 0.08);
        }

        .info-item h4 {
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 8px;
            font-size: 0.85rem;
            text-transform: uppercase;
            font-weight: 500;
            letter-spacing: 1px;
        }

        .info-item p {
            font-size: 1.5rem;
            font-weight: 600;
            color: #ffffff;
            font-family: 'JetBrains Mono', monospace;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.2);
            border-top: 3px solid #7c77c6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .card {
            animation: fadeInUp 0.6s ease-out;
        }

        .card:nth-child(2) { animation-delay: 0.1s; }
        .card:nth-child(3) { animation-delay: 0.2s; }
        .card:nth-child(4) { animation-delay: 0.3s; }

        .history-section {
            margin-top: 30px;
        }

        .history-item {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .history-item.success {
            border-left: 4px solid #28a745;
        }

        .history-item.failed {
            border-left: 4px solid #dc3545;
        }

        .feature-list {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
        }

        .feature-list h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .feature-list ul {
            list-style: none;
        }

        .feature-list li {
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .feature-list li:last-child {
            border-bottom: none;
        }

        .feature-list li::before {
            content: "üîí";
            margin-right: 10px;
        }

        .feature-list {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 32px;
            margin-top: 40px;
        }

        .feature-list h3 {
            color: #ffffff;
            margin-bottom: 24px;
            font-size: 1.3rem;
            font-weight: 600;
        }

        .feature-list ul {
            list-style: none;
        }

        .feature-list li {
            padding: 16px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.8);
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .feature-list li:last-child {
            border-bottom: none;
        }

        .feature-list li:hover {
            color: #ffffff;
            padding-left: 10px;
        }

        .feature-list li::before {
            content: "üîí";
            margin-right: 12px;
            font-size: 1.1em;
        }

        .history-item {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .history-item:hover {
            background: rgba(255, 255, 255, 0.05);
            transform: translateX(4px);
        }

        .history-item.success {
            border-left: 4px solid #10b981;
        }

        .history-item.failed {
            border-left: 4px solid #ef4444;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px 15px;
            }

            .header {
                margin-bottom: 40px;
            }

            .header h1 {
                font-size: clamp(2rem, 8vw, 3rem);
            }

            .function-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .wallet-info {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }

            .function-card {
                padding: 24px;
            }

            .connect-wallet {
                padding: 60px 20px;
            }
        }

        @media (max-width: 480px) {
            .function-grid {
                grid-template-columns: 1fr;
            }

            .function-card {
                padding: 20px;
            }

            .card {
                padding: 24px;
            }

            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîê Privacy Biometric System</h1>
            <p>Secure biometric authentication using Zama's Fully Homomorphic Encryption</p>
        </div>

        <!-- Wallet Connection Section -->
        <div id="connectSection" class="card connect-wallet">
            <h2>Connect Your Wallet</h2>
            <p style="margin: 20px 0; color: #666;">
                Connect your MetaMask wallet to access the privacy biometric authentication system
            </p>
            <button id="connectBtn" class="connect-btn">
                ü¶ä Connect MetaMask
            </button>
            <div id="statusMessage"></div>

            <div class="feature-list">
                <h3>System Features</h3>
                <ul>
                    <li>Multi-modal biometric authentication (Fingerprint, Face, Voice, Iris)</li>
                    <li>Fully encrypted biometric storage using FHE</li>
                    <li>Zero-knowledge verification process</li>
                    <li>Access control and authorization management</li>
                    <li>Complete audit trail of access attempts</li>
                    <li>Emergency deactivation capabilities</li>
                </ul>
            </div>
        </div>

        <!-- Main Interface -->
        <div id="mainInterface" class="main-interface">
            <!-- Wallet Info -->
            <div class="card wallet-info">
                <div class="wallet-details">
                    <h3>Connected Wallet</h3>
                    <p id="walletAddress">0x...</p>
                    <p id="networkInfo">Sepolia Testnet</p>
                </div>
                <button id="disconnectBtn" class="disconnect-btn">Disconnect</button>
            </div>

            <!-- Contract Information -->
            <div id="contractInfo" class="contract-info">
                <h3>Contract Statistics</h3>
                <div class="info-grid">
                    <div class="info-item">
                        <h4>Total Users</h4>
                        <p id="totalUsers">0</p>
                    </div>
                    <div class="info-item">
                        <h4>Active Users</h4>
                        <p id="activeUsers">0</p>
                    </div>
                    <div class="info-item">
                        <h4>Total Attempts</h4>
                        <p id="totalAttempts">0</p>
                    </div>
                    <div class="info-item">
                        <h4>User Status</h4>
                        <p id="userStatus">Not Registered</p>
                    </div>
                </div>
            </div>

            <!-- Function Cards -->
            <div class="function-grid">
                <!-- Register Biometric -->
                <div class="function-card">
                    <h3>üîí Register Biometric</h3>
                    <p style="margin-bottom: 20px; color: #666;">Register your biometric templates securely</p>

                    <div class="input-group">
                        <label for="fingerprintHash">Fingerprint Hash (uint64)</label>
                        <input type="text" id="fingerprintHash" placeholder="e.g., 1234567890123456789" maxlength="20">
                        <small style="color: rgba(255,255,255,0.6); font-size: 0.85rem;">Max value: 18446744073709551615</small>
                    </div>

                    <div class="input-group">
                        <label for="faceTemplateHash">Face Template Hash (uint64)</label>
                        <input type="text" id="faceTemplateHash" placeholder="e.g., 9876543210987654321" maxlength="20">
                        <small style="color: rgba(255,255,255,0.6); font-size: 0.85rem;">Max value: 18446744073709551615</small>
                    </div>

                    <div class="input-group">
                        <label for="voicePrintHash">Voice Print Hash (uint32)</label>
                        <input type="text" id="voicePrintHash" placeholder="e.g., 1357924680" maxlength="10">
                        <small style="color: rgba(255,255,255,0.6); font-size: 0.85rem;">Max value: 4294967295</small>
                    </div>

                    <div class="input-group">
                        <label for="irisPattern">Iris Pattern (uint32)</label>
                        <input type="text" id="irisPattern" placeholder="e.g., 2468135790" maxlength="10">
                        <small style="color: rgba(255,255,255,0.6); font-size: 0.85rem;">Max value: 4294967295</small>
                    </div>

                    <button id="registerBtn" class="action-btn">Register Biometric</button>
                </div>

                <!-- Verify Biometric -->
                <div class="function-card">
                    <h3>‚úÖ Verify Biometric</h3>
                    <p style="margin-bottom: 20px; color: #666;">Verify your identity using biometric data</p>

                    <div class="input-group">
                        <label for="verifyFingerprintHash">Fingerprint Hash (uint64)</label>
                        <input type="text" id="verifyFingerprintHash" placeholder="e.g., 1234567890123456789" maxlength="20">
                        <small style="color: rgba(255,255,255,0.6); font-size: 0.85rem;">Max value: 18446744073709551615</small>
                    </div>

                    <div class="input-group">
                        <label for="verifyFaceTemplateHash">Face Template Hash (uint64)</label>
                        <input type="text" id="verifyFaceTemplateHash" placeholder="e.g., 9876543210987654321" maxlength="20">
                        <small style="color: rgba(255,255,255,0.6); font-size: 0.85rem;">Max value: 18446744073709551615</small>
                    </div>

                    <div class="input-group">
                        <label for="verifyVoicePrintHash">Voice Print Hash (uint32)</label>
                        <input type="text" id="verifyVoicePrintHash" placeholder="e.g., 1357924680" maxlength="10">
                        <small style="color: rgba(255,255,255,0.6); font-size: 0.85rem;">Max value: 4294967295</small>
                    </div>

                    <div class="input-group">
                        <label for="verifyIrisPattern">Iris Pattern (uint32)</label>
                        <input type="text" id="verifyIrisPattern" placeholder="e.g., 2468135790" maxlength="10">
                        <small style="color: rgba(255,255,255,0.6); font-size: 0.85rem;">Max value: 4294967295</small>
                    </div>

                    <button id="verifyBtn" class="action-btn">Verify Biometric</button>
                </div>

                <!-- Update Biometric -->
                <div class="function-card">
                    <h3>üîÑ Update Biometric</h3>
                    <p style="margin-bottom: 20px; color: #666;">Update your existing biometric templates</p>

                    <div class="input-group">
                        <label for="updateFingerprintHash">New Fingerprint Hash (uint64)</label>
                        <input type="text" id="updateFingerprintHash" placeholder="e.g., 5555555555555555555" maxlength="20">
                        <small style="color: rgba(255,255,255,0.6); font-size: 0.85rem;">Max value: 18446744073709551615</small>
                    </div>

                    <div class="input-group">
                        <label for="updateFaceTemplateHash">New Face Template Hash (uint64)</label>
                        <input type="text" id="updateFaceTemplateHash" placeholder="e.g., 7777777777777777777" maxlength="20">
                        <small style="color: rgba(255,255,255,0.6); font-size: 0.85rem;">Max value: 18446744073709551615</small>
                    </div>

                    <div class="input-group">
                        <label for="updateVoicePrintHash">New Voice Print Hash (uint32)</label>
                        <input type="text" id="updateVoicePrintHash" placeholder="e.g., 3333333333" maxlength="10">
                        <small style="color: rgba(255,255,255,0.6); font-size: 0.85rem;">Max value: 4294967295</small>
                    </div>

                    <div class="input-group">
                        <label for="updateIrisPattern">New Iris Pattern (uint32)</label>
                        <input type="text" id="updateIrisPattern" placeholder="e.g., 9999999999" maxlength="10">
                        <small style="color: rgba(255,255,255,0.6); font-size: 0.85rem;">Max value: 4294967295</small>
                    </div>

                    <button id="updateBtn" class="action-btn">Update Biometric</button>
                </div>

                <!-- Utility Functions -->
                <div class="function-card">
                    <h3>üõ†Ô∏è Utilities</h3>
                    <p style="margin-bottom: 20px; color: #666;">Additional functions and tools</p>

                    <div class="input-group">
                        <label for="rawBiometric">Raw Biometric Data</label>
                        <input type="text" id="rawBiometric" placeholder="Enter raw biometric data">
                    </div>

                    <div class="input-group">
                        <label for="saltValue">Salt Value</label>
                        <input type="text" id="saltValue" placeholder="Enter salt value">
                    </div>

                    <button id="generateHashBtn" class="action-btn" style="margin-bottom: 15px;">Generate Secure Hash</button>
                    <button id="deactivateBtn" class="action-btn" style="background: #dc3545;">Deactivate Biometric</button>
                </div>
            </div>

            <!-- Access History -->
            <div class="card history-section">
                <h3>üìä Access History</h3>
                <div id="accessHistory">
                    <p style="color: #666; text-align: center; padding: 20px;">No access history available</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let provider;
        let signer;
        let contract;
        let userAccount;

        // Contract configuration
        const CONTRACT_ADDRESS = "0x349F5d8377683805206A56D692611b439B8CF916"; // Deployed PrivacyBiometric contract
        const CONTRACT_ABI = [
            "function owner() view returns (address)",
            "function totalUsers() view returns (uint256)",
            "function registerBiometric(uint64 _fingerprintHash, uint64 _faceTemplateHash, uint32 _voicePrintHash, uint32 _irisPattern)",
            "function verifyBiometric(uint64 _fingerprintHash, uint64 _faceTemplateHash, uint32 _voicePrintHash, uint32 _irisPattern) returns (bool)",
            "function updateBiometric(uint64 _fingerprintHash, uint64 _faceTemplateHash, uint32 _voicePrintHash, uint32 _irisPattern)",
            "function deactivateBiometric()",
            "function authorizeUser(address _user)",
            "function deauthorizeUser(address _user)",
            "function getUserBiometricStatus(address _user) view returns (bool isActive, uint256 timestamp, uint256 accessCount)",
            "function getAccessHistoryLength(address _user) view returns (uint256)",
            "function getAccessAttempt(address _user, uint256 _index) view returns (bool verified, uint256 timestamp, uint256 confidenceScore)",
            "function getRegisteredUsersCount() view returns (uint256)",
            "function getAllRegisteredUsers() view returns (address[])",
            "function isUserAuthorized(address _user) view returns (bool)",
            "function generateSecureBiometricHash(uint64 _rawBiometric, uint32 _salt) view returns (uint64)",
            "function emergencyDeactivateAll()",
            "function getContractStats() view returns (uint256 _totalUsers, uint256 _totalAccessAttempts, uint256 _activeUsers)",
            "event BiometricRegistered(address indexed user, uint256 timestamp)",
            "event AccessAttempted(address indexed user, bool verified, uint256 timestamp)",
            "event BiometricUpdated(address indexed user, uint256 timestamp)",
            "event UserAuthorized(address indexed user, address indexed authorizer)",
            "event UserDeauthorized(address indexed user, address indexed deauthorizer)",
            "event BiometricVerificationCompleted(address indexed user, uint256 confidenceScore)"
        ];

        const SEPOLIA_CHAIN_ID = "0xaa36a7";
        const SEPOLIA_CONFIG = {
            chainId: SEPOLIA_CHAIN_ID,
            chainName: "Sepolia Testnet",
            rpcUrls: ["https://sepolia.infura.io/v3/"],
            nativeCurrency: {
                name: "ETH",
                symbol: "ETH",
                decimals: 18
            },
            blockExplorerUrls: ["https://sepolia.etherscan.io/"]
        };

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            checkConnection();
            setupEventListeners();
        });

        // Setup event listeners
        function setupEventListeners() {
            document.getElementById('connectBtn').addEventListener('click', connectWallet);
            document.getElementById('disconnectBtn').addEventListener('click', disconnectWallet);
            document.getElementById('registerBtn').addEventListener('click', registerBiometric);
            document.getElementById('verifyBtn').addEventListener('click', verifyBiometric);
            document.getElementById('updateBtn').addEventListener('click', updateBiometric);
            document.getElementById('generateHashBtn').addEventListener('click', generateSecureHash);
            document.getElementById('deactivateBtn').addEventListener('click', deactivateBiometric);
        }

        // Check if wallet is already connected
        async function checkConnection() {
            if (typeof window.ethereum !== 'undefined') {
                try {
                    const accounts = await window.ethereum.request({ method: 'eth_accounts' });
                    if (accounts.length > 0) {
                        await initializeConnection(accounts[0]);
                    }
                } catch (error) {
                    console.error('Error checking connection:', error);
                }
            }
        }

        // Connect wallet function
        async function connectWallet() {
            const connectBtn = document.getElementById('connectBtn');
            const statusMessage = document.getElementById('statusMessage');

            // Step 1: Check for MetaMask
            if (typeof window.ethereum === 'undefined') {
                showStatus('MetaMask is not installed. Please install MetaMask to continue.', 'error');
                return;
            }

            try {
                connectBtn.disabled = true;
                connectBtn.innerHTML = '<span class="loading"></span>Connecting...';

                // Step 2: Request account access
                showStatus('Requesting wallet access...', 'info');
                const accounts = await window.ethereum.request({
                    method: 'eth_requestAccounts'
                });

                if (accounts.length === 0) {
                    throw new Error('No accounts returned from MetaMask');
                }

                // Step 3: Check network
                const chainId = await window.ethereum.request({ method: 'eth_chainId' });

                if (chainId !== SEPOLIA_CHAIN_ID) {
                    showStatus('Switching to Sepolia testnet...', 'info');

                    try {
                        // Step 4: Switch to Sepolia
                        await window.ethereum.request({
                            method: 'wallet_switchEthereumChain',
                            params: [{ chainId: SEPOLIA_CHAIN_ID }],
                        });
                    } catch (switchError) {
                        // If network doesn't exist, add it
                        if (switchError.code === 4902) {
                            await window.ethereum.request({
                                method: 'wallet_addEthereumChain',
                                params: [SEPOLIA_CONFIG],
                            });
                        } else {
                            throw switchError;
                        }
                    }
                }

                // Step 5: Initialize provider and signer
                await initializeConnection(accounts[0]);

                // Step 6: Show success message
                showStatus('Successfully connected to Sepolia! ‚úÖ', 'success');

                // Step 7: Update UI
                setTimeout(() => {
                    document.getElementById('connectSection').style.display = 'none';
                    document.getElementById('mainInterface').classList.add('active');
                    loadContractData();
                }, 1500);

            } catch (error) {
                console.error('Connection error:', error);
                showStatus(`Connection failed: ${error.message}`, 'error');
                connectBtn.disabled = false;
                connectBtn.innerHTML = 'ü¶ä Connect MetaMask';
            }
        }

        // Initialize connection
        async function initializeConnection(account) {
            // Step 5: Create provider and signer (ethers v6 syntax)
            provider = new ethers.BrowserProvider(window.ethereum);
            signer = await provider.getSigner();
            userAccount = account;

            // Step 6: Initialize contract (when address is available)
            if (CONTRACT_ADDRESS && CONTRACT_ABI.length > 0) {
                try {
                    contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);
                    console.log('Contract initialized successfully:', CONTRACT_ADDRESS);
                } catch (error) {
                    console.error('Error initializing contract:', error);
                }
            } else {
                console.warn('Contract address or ABI not available');
            }

            // Update wallet info
            document.getElementById('walletAddress').textContent =
                `${account.substring(0, 6)}...${account.substring(38)}`;

            // Listen for account changes
            window.ethereum.on('accountsChanged', handleAccountsChanged);
            window.ethereum.on('chainChanged', handleChainChanged);
        }

        // Handle account changes
        function handleAccountsChanged(accounts) {
            if (accounts.length === 0) {
                disconnectWallet();
            } else {
                userAccount = accounts[0];
                document.getElementById('walletAddress').textContent =
                    `${accounts[0].substring(0, 6)}...${accounts[0].substring(38)}`;
                loadContractData();
            }
        }

        // Handle chain changes
        function handleChainChanged(chainId) {
            if (chainId !== SEPOLIA_CHAIN_ID) {
                showStatus('Please switch back to Sepolia testnet', 'error');
            } else {
                loadContractData();
            }
        }

        // Disconnect wallet
        function disconnectWallet() {
            provider = null;
            signer = null;
            contract = null;
            userAccount = null;

            document.getElementById('connectSection').style.display = 'block';
            document.getElementById('mainInterface').classList.remove('active');

            // Remove event listeners
            if (window.ethereum) {
                window.ethereum.removeAllListeners('accountsChanged');
                window.ethereum.removeAllListeners('chainChanged');
            }
        }

        // Show status message
        function showStatus(message, type) {
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.className = `status ${type}`;
            statusDiv.textContent = message;
            statusDiv.style.display = 'block';

            if (type === 'success') {
                setTimeout(() => {
                    statusDiv.style.display = 'none';
                }, 3000);
            }
        }

        // Load contract data
        async function loadContractData() {
            if (!contract) {
                document.getElementById('userStatus').textContent = 'Contract loading...';
                console.log('Contract not initialized yet');
                return;
            }

            console.log('Loading contract data from:', CONTRACT_ADDRESS);

            try {
                // Load contract statistics (ethers v6 syntax)
                const stats = await contract.getContractStats();
                document.getElementById('totalUsers').textContent = stats[0].toString();
                document.getElementById('totalAttempts').textContent = stats[1].toString();
                document.getElementById('activeUsers').textContent = stats[2].toString();

                // Check user status
                const userStatus = await contract.getUserBiometricStatus(userAccount);
                document.getElementById('userStatus').textContent =
                    userStatus[0] ? 'Registered' : 'Not Registered';

                // Load access history
                await loadAccessHistory();

            } catch (error) {
                console.error('Error loading contract data:', error);
            }
        }

        // Load access history
        async function loadAccessHistory() {
            if (!contract || !userAccount) return;

            try {
                const historyLength = await contract.getAccessHistoryLength(userAccount);
                const historyDiv = document.getElementById('accessHistory');

                if (Number(historyLength) === 0) {
                    historyDiv.innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">No access history available</p>';
                    return;
                }

                let historyHTML = '';
                for (let i = 0; i < Number(historyLength); i++) {
                    const attempt = await contract.getAccessAttempt(userAccount, i);
                    const date = new Date(Number(attempt[1]) * 1000).toLocaleString();
                    const statusClass = attempt[0] ? 'success' : 'failed';

                    historyHTML += `
                        <div class="history-item ${statusClass}">
                            <div>
                                <strong>${attempt[0] ? 'Verified' : 'Failed'}</strong>
                                <p style="color: #666; font-size: 0.9rem;">${date}</p>
                            </div>
                            <div>
                                <span style="font-weight: bold;">Score: ${attempt[2]}%</span>
                            </div>
                        </div>
                    `;
                }

                historyDiv.innerHTML = historyHTML;

            } catch (error) {
                console.error('Error loading access history:', error);
            }
        }

        // Validation functions
        function validateUint64(value, fieldName) {
            if (!value || value.trim() === '') {
                return `${fieldName} is required`;
            }

            if (!/^\d+$/.test(value)) {
                return `${fieldName} must contain only numbers`;
            }

            const maxUint64 = '18446744073709551615';
            if (value.length > maxUint64.length || (value.length === maxUint64.length && value > maxUint64)) {
                return `${fieldName} exceeds maximum value (${maxUint64})`;
            }

            return null;
        }

        function validateUint32(value, fieldName) {
            if (!value || value.trim() === '') {
                return `${fieldName} is required`;
            }

            if (!/^\d+$/.test(value)) {
                return `${fieldName} must contain only numbers`;
            }

            const maxUint32 = 4294967295;
            if (parseInt(value) > maxUint32) {
                return `${fieldName} exceeds maximum value (${maxUint32})`;
            }

            return null;
        }

        function validateBiometricInputs(fingerprintHash, faceTemplateHash, voicePrintHash, irisPattern) {
            const errors = [];

            const fpError = validateUint64(fingerprintHash, 'Fingerprint Hash');
            if (fpError) errors.push(fpError);

            const faceError = validateUint64(faceTemplateHash, 'Face Template Hash');
            if (faceError) errors.push(faceError);

            const voiceError = validateUint32(voicePrintHash, 'Voice Print Hash');
            if (voiceError) errors.push(voiceError);

            const irisError = validateUint32(irisPattern, 'Iris Pattern');
            if (irisError) errors.push(irisError);

            return errors;
        }

        // Contract interaction functions
        async function registerBiometric() {
            if (!contract) {
                alert('Contract not available. Please ensure it is deployed and configured.');
                return;
            }

            const fingerprintHash = document.getElementById('fingerprintHash').value.trim();
            const faceTemplateHash = document.getElementById('faceTemplateHash').value.trim();
            const voicePrintHash = document.getElementById('voicePrintHash').value.trim();
            const irisPattern = document.getElementById('irisPattern').value.trim();

            // Validate inputs
            const errors = validateBiometricInputs(fingerprintHash, faceTemplateHash, voicePrintHash, irisPattern);
            if (errors.length > 0) {
                alert('Validation Errors:\n‚Ä¢ ' + errors.join('\n‚Ä¢ '));
                return;
            }

            try {
                const btn = document.getElementById('registerBtn');
                btn.disabled = true;
                btn.innerHTML = '<span class="loading"></span>Registering...';

                const tx = await contract.registerBiometric(
                    fingerprintHash,
                    faceTemplateHash,
                    parseInt(voicePrintHash),
                    parseInt(irisPattern)
                );

                await tx.wait();
                alert('Biometric registered successfully!');

                // Clear form
                document.getElementById('fingerprintHash').value = '';
                document.getElementById('faceTemplateHash').value = '';
                document.getElementById('voicePrintHash').value = '';
                document.getElementById('irisPattern').value = '';

                // Reload data
                loadContractData();

            } catch (error) {
                console.error('Registration error:', error);
                alert(`Registration failed: ${error.message}`);
            } finally {
                const btn = document.getElementById('registerBtn');
                btn.disabled = false;
                btn.innerHTML = 'Register Biometric';
            }
        }

        async function verifyBiometric() {
            if (!contract) {
                alert('Contract not available. Please ensure it is deployed and configured.');
                return;
            }

            const fingerprintHash = document.getElementById('verifyFingerprintHash').value.trim();
            const faceTemplateHash = document.getElementById('verifyFaceTemplateHash').value.trim();
            const voicePrintHash = document.getElementById('verifyVoicePrintHash').value.trim();
            const irisPattern = document.getElementById('verifyIrisPattern').value.trim();

            // Validate inputs
            const errors = validateBiometricInputs(fingerprintHash, faceTemplateHash, voicePrintHash, irisPattern);
            if (errors.length > 0) {
                alert('Validation Errors:\n‚Ä¢ ' + errors.join('\n‚Ä¢ '));
                return;
            }

            try {
                const btn = document.getElementById('verifyBtn');
                btn.disabled = true;
                btn.innerHTML = '<span class="loading"></span>Verifying...';

                const tx = await contract.verifyBiometric(
                    fingerprintHash,
                    faceTemplateHash,
                    parseInt(voicePrintHash),
                    parseInt(irisPattern)
                );

                await tx.wait();
                alert('Verification submitted! Results will be processed asynchronously.');

                // Clear form
                document.getElementById('verifyFingerprintHash').value = '';
                document.getElementById('verifyFaceTemplateHash').value = '';
                document.getElementById('verifyVoicePrintHash').value = '';
                document.getElementById('verifyIrisPattern').value = '';

                // Reload data after a delay
                setTimeout(loadContractData, 3000);

            } catch (error) {
                console.error('Verification error:', error);
                alert(`Verification failed: ${error.message}`);
            } finally {
                const btn = document.getElementById('verifyBtn');
                btn.disabled = false;
                btn.innerHTML = 'Verify Biometric';
            }
        }

        async function updateBiometric() {
            if (!contract) {
                alert('Contract not available. Please ensure it is deployed and configured.');
                return;
            }

            const fingerprintHash = document.getElementById('updateFingerprintHash').value.trim();
            const faceTemplateHash = document.getElementById('updateFaceTemplateHash').value.trim();
            const voicePrintHash = document.getElementById('updateVoicePrintHash').value.trim();
            const irisPattern = document.getElementById('updateIrisPattern').value.trim();

            // Validate inputs
            const errors = validateBiometricInputs(fingerprintHash, faceTemplateHash, voicePrintHash, irisPattern);
            if (errors.length > 0) {
                alert('Validation Errors:\n‚Ä¢ ' + errors.join('\n‚Ä¢ '));
                return;
            }

            try {
                const btn = document.getElementById('updateBtn');
                btn.disabled = true;
                btn.innerHTML = '<span class="loading"></span>Updating...';

                const tx = await contract.updateBiometric(
                    fingerprintHash,
                    faceTemplateHash,
                    parseInt(voicePrintHash),
                    parseInt(irisPattern)
                );

                await tx.wait();
                alert('Biometric updated successfully!');

                // Clear form
                document.getElementById('updateFingerprintHash').value = '';
                document.getElementById('updateFaceTemplateHash').value = '';
                document.getElementById('updateVoicePrintHash').value = '';
                document.getElementById('updateIrisPattern').value = '';

                loadContractData();

            } catch (error) {
                console.error('Update error:', error);
                alert(`Update failed: ${error.message}`);
            } finally {
                const btn = document.getElementById('updateBtn');
                btn.disabled = false;
                btn.innerHTML = 'Update Biometric';
            }
        }

        async function generateSecureHash() {
            if (!contract) {
                alert('Contract not available. Please ensure it is deployed and configured.');
                return;
            }

            const rawBiometric = document.getElementById('rawBiometric').value;
            const saltValue = document.getElementById('saltValue').value;

            if (!rawBiometric || !saltValue) {
                alert('Please fill in raw biometric data and salt value');
                return;
            }

            try {
                const btn = document.getElementById('generateHashBtn');
                btn.disabled = true;
                btn.innerHTML = '<span class="loading"></span>Generating...';

                const hash = await contract.generateSecureBiometricHash(
                    rawBiometric,
                    parseInt(saltValue)
                );

                alert(`Generated Hash: ${hash.toString()}`);

            } catch (error) {
                console.error('Hash generation error:', error);
                alert(`Hash generation failed: ${error.message}`);
            } finally {
                const btn = document.getElementById('generateHashBtn');
                btn.disabled = false;
                btn.innerHTML = 'Generate Secure Hash';
            }
        }

        async function deactivateBiometric() {
            if (!contract) {
                alert('Contract not available. Please ensure it is deployed and configured.');
                return;
            }

            if (!confirm('Are you sure you want to deactivate your biometric? This action cannot be undone.')) {
                return;
            }

            try {
                const btn = document.getElementById('deactivateBtn');
                btn.disabled = true;
                btn.innerHTML = '<span class="loading"></span>Deactivating...';

                const tx = await contract.deactivateBiometric();
                await tx.wait();

                alert('Biometric deactivated successfully!');
                loadContractData();

            } catch (error) {
                console.error('Deactivation error:', error);
                alert(`Deactivation failed: ${error.message}`);
            } finally {
                const btn = document.getElementById('deactivateBtn');
                btn.disabled = false;
                btn.innerHTML = 'Deactivate Biometric';
            }
        }
    </script>
</body>
</html>